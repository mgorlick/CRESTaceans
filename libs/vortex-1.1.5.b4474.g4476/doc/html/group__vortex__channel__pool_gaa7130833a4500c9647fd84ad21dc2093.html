<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>Vortex Library, BEEP Core implementation, RFC 3080 / RFC 3081, XML-RPC, XML-RPC over BEEP, RFC 3529, BEEP Framework, BEEP protocol, BEEP, BEEP library, BEEP libraries, beepcore (Servidores Linux http://www.aspl.es)</title>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-123192-2";
urchinTracker();
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="vortex.css" rel="stylesheet" type="text/css">
</head>
  <body>
    <div class="af-arch-header">
     <img src="main-page-logo.png" > <a href="http://www.aspl.es"><img class="aspl-logo-header" src="aspl-logo-header.png"></a>
    </div>
    <div class="ads">
    <iframe src="http://www.aspl.es/web-ads/index.php?hcolor=fdff4f&amp;fsize=10&amp;bg=555753&amp;fg=ffffff&amp;width=800&amp;height=90" scrolling="no" frameborder="0"></iframe> 
    </div>
    <div class="separator">
    </div>
<div class="thepage">

<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
  <div class="navpath"><a class="el" href="group__vortex__channel__pool.html">Vortex Channel Pool: Channel Pool management function.</a>
  </div>
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td valign="top">
      <div class="navtab">
        <table>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_gaf80c90eb6225073b0509731abfe7ee52.html#gaf80c90eb6225073b0509731abfe7ee52">vortex_channel_pool_add</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_gab1afa3d8a2865d874877f1bf7c16ed22.html#gab1afa3d8a2865d874877f1bf7c16ed22">vortex_channel_pool_add_full</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga17ac628c4f7d3c29558a02d7d1612481.html#ga17ac628c4f7d3c29558a02d7d1612481">vortex_channel_pool_attach</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga9c9a7f4e336860f4f33964f562763b5a.html#ga9c9a7f4e336860f4f33964f562763b5a">vortex_channel_pool_close</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga6af5ce427204267c6addc4092a78b87f.html#ga6af5ce427204267c6addc4092a78b87f">vortex_channel_pool_deattach</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga7e421838e536851df496d7bda05b9c91.html#ga7e421838e536851df496d7bda05b9c91">vortex_channel_pool_get_available_num</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga2cec0114da1f37c9ba3aab6cdbf09ed5.html#ga2cec0114da1f37c9ba3aab6cdbf09ed5">vortex_channel_pool_get_connection</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_gaf6f42c85814ef195b0ac63c00ddee30e.html#gaf6f42c85814ef195b0ac63c00ddee30e">vortex_channel_pool_get_id</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga3336a50e2f4437f64aa3334c4837ba02.html#ga3336a50e2f4437f64aa3334c4837ba02">vortex_channel_pool_get_next_ready</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_gaf361e67cf185cf0a05f28e87cd2e4f76.html#gaf361e67cf185cf0a05f28e87cd2e4f76">vortex_channel_pool_get_next_ready_full</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga4b434ba596785bd8393a9f2db1e0bd1a.html#ga4b434ba596785bd8393a9f2db1e0bd1a">vortex_channel_pool_get_num</a></td></tr>
          <tr><td class="navtab"><a class="qindexHL" href="group__vortex__channel__pool_gaa7130833a4500c9647fd84ad21dc2093.html#gaa7130833a4500c9647fd84ad21dc2093">vortex_channel_pool_new</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_gace7483ec55b1d4953dbbeee67bffcb8d.html#gace7483ec55b1d4953dbbeee67bffcb8d">vortex_channel_pool_new_full</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_ga640cf86cb4cf7ddff6a03823208c1b14.html#ga640cf86cb4cf7ddff6a03823208c1b14">vortex_channel_pool_release_channel</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__channel__pool_gacc293e91ce8ef22b4f141526dd78e480.html#gacc293e91ce8ef22b4f141526dd78e480">vortex_channel_pool_remove</a></td></tr>
        </table>
      </div>
   </td>
   <td valign="top">
<a class="anchor" id="gaa7130833a4500c9647fd84ad21dc2093"></a><!-- doxytag: member="vortex_channel_pool.c::vortex_channel_pool_new" ref="gaa7130833a4500c9647fd84ad21dc2093" args="(VortexConnection *connection, const char *profile, int init_num, VortexOnCloseChannel close, axlPointer close_user_data, VortexOnFrameReceived received, axlPointer received_user_data, VortexOnChannelPoolCreated on_channel_pool_created, axlPointer user_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__vortex__types_ga8335cf8b240d5f8a6ae9407a3c050bbf.html#ga8335cf8b240d5f8a6ae9407a3c050bbf">VortexChannelPool</a>* vortex_channel_pool_new </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4">VortexConnection</a> *&nbsp;</td>
          <td class="paramname"> <em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>profile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>init_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__vortex__handlers_ga80a1b36b5894abf6b39054d7f4b16b98.html#ga80a1b36b5894abf6b39054d7f4b16b98">VortexOnCloseChannel</a>&nbsp;</td>
          <td class="paramname"> <em>close</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">axlPointer&nbsp;</td>
          <td class="paramname"> <em>close_user_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__vortex__handlers_ga9b856fd8f489ea778799e610eaa0e619.html#ga9b856fd8f489ea778799e610eaa0e619">VortexOnFrameReceived</a>&nbsp;</td>
          <td class="paramname"> <em>received</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">axlPointer&nbsp;</td>
          <td class="paramname"> <em>received_user_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__vortex__handlers_ga5698fedfcb3894332913327b677e4571.html#ga5698fedfcb3894332913327b677e4571">VortexOnChannelPoolCreated</a>&nbsp;</td>
          <td class="paramname"> <em>on_channel_pool_created</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">axlPointer&nbsp;</td>
          <td class="paramname"> <em>user_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Creates a new pool of <a class="el" href="group__vortex__types_ga9dab9d627d67bfc4cccf2687725ee60f.html#ga9dab9d627d67bfc4cccf2687725ee60f">VortexChannel</a> items, that are managed in a way that ensure better throutput relation. </p>
<p>This module was created to allow having a pool of pre-created channels (<a class="el" href="group__vortex__types_ga9dab9d627d67bfc4cccf2687725ee60f.html#ga9dab9d627d67bfc4cccf2687725ee60f">VortexChannel</a>) to be used over and over again during the application life.</p>
<p>Because channel creation and channel close is an expensive process (especially due to all requirements to be meet during channel close), the channel pool can help to improve greatly your application communication throughput, considering the relation between request/replies received on a selected connection (<a class="el" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4">VortexConnection</a>).</p>
<p>Keep in mind the following facts which may help you to chose using vortex channel pool instead of controlling yourself channels created on a particular connection.</p>
<ul>
<li>
<p class="startli">If an application needs to not be blocked while sending messages you have to use a new channel or a channel that is not waiting for a reply, so new messages (requests) are not blocked by replies for previous messages (requests).</p>
<p>BEEP RFC definition states: <em>"any message sent will be delivered in order at the remote peer and remote peer <b>must</b> reply the message receive in the same order."</em></p>
<p>As a consequence, if message a and b are sent over channel 1, the message reply for b won't be received until message reply for a is received.</p>
<p>In other words, if your applications needs to have a and b message to be managed independently, you'll have to use different channel, making each interaction to be independent, and those channels must not be waiting for a previous reply (<a class="el" href="group__vortex__channel_ga11704c9cdca0b35890345851f3f850d2.html#ga11704c9cdca0b35890345851f3f850d2">vortex_channel_is_ready</a>).</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">To start a channel needs two message to be exchanged between peers and, of course, the channel creation can be denied by remote peer. This have a considerable overhead.</p>
<p class="endli"></p>
</li>
<li>
To close a channel needs two message to be exchanged between peers and remote peers may accept channel to be closed at any time. This is not only a overhead problem but also great performance impact problem if your application close channels frequently. </li>
</ul>
<p>The <a class="el" href="group__vortex__types_ga8335cf8b240d5f8a6ae9407a3c050bbf.html#ga8335cf8b240d5f8a6ae9407a3c050bbf">VortexChannelPool</a> allows you to create a pool of channels and reuse then on next operations, saving starts/close operations, based on the readyness of channels inside the pool.</p>
<p>This notion of "ready to be used" means that the channel have no pending replies to be received so if you application send a message it will receive the reply as soon as possible (<a class="el" href="group__vortex__channel_ga11704c9cdca0b35890345851f3f850d2.html#ga11704c9cdca0b35890345851f3f850d2">vortex_channel_is_ready</a>).</p>
<p>Actually the reply can be really late due to remote peer processing but it will not be delayed by messages previously sent, awaiting for replies.</p>
<p>Once you create a pool you can get its actual size, add or remove channel from the pool or attach new channel that weren't created by this module. In general, we can consider that there are two ways to use the channel pool once created:</p>
<ul>
<li>
<p class="startli"></p>
<p>Allow the channel pool to manage the channel creation (setting all data to be used at this function: start handler, frame received, etc..). In this context you must use the following function to add and remove channels to the pool:</p>
<ul>
<li><a class="el" href="group__vortex__channel__pool_gaf80c90eb6225073b0509731abfe7ee52.html#gaf80c90eb6225073b0509731abfe7ee52">vortex_channel_pool_add</a></li>
<li><a class="el" href="group__vortex__channel__pool_gacc293e91ce8ef22b4f141526dd78e480.html#gacc293e91ce8ef22b4f141526dd78e480">vortex_channel_pool_remove</a></li>
</ul>
<p class="endli"></p>
</li>
<li>
<p class="startli"></p>
<p>In the case that the channel creation is too complex or the application level wants to control the channel creation process, you must use the following functions to add channels to the pool:</p>
<ul>
<li><a class="el" href="group__vortex__channel__pool_ga17ac628c4f7d3c29558a02d7d1612481.html#ga17ac628c4f7d3c29558a02d7d1612481">vortex_channel_pool_attach</a></li>
<li><a class="el" href="group__vortex__channel__pool_ga6af5ce427204267c6addc4092a78b87f.html#ga6af5ce427204267c6addc4092a78b87f">vortex_channel_pool_deattach</a></li>
</ul>
<p>This method have a problem: automatic channel creation is not activated. The channel pool could react by adding more channels if a channel is requested but no channel is available (<a class="el" href="group__vortex__channel__pool_ga3336a50e2f4437f64aa3334c4837ba02.html#ga3336a50e2f4437f64aa3334c4837ba02">vortex_channel_pool_get_next_ready</a>).</p>
<p class="endli"></p>
</li>
</ul>
<p>In the case that channel creation process is managed by the channel pool, all of them will be created over the given session (<em>connection</em>) and will be created under the semantics defined by <em>profile</em>. The function will block you until all channels are created. During the channel creation process one channel may fail to be created so you should check how many channels have been really created.</p>
<p>You can create several channel pools over the same connection. Every channel pool is identified by an id. This Id can be used to lookup certain channel pool into a given connection.</p>
<p>Once a channel pool is created, it is associated with the given connection so calls to <a class="el" href="group__vortex__connection_ga225e43c94ba4cb6e23e1f87e430b8f33.html#ga225e43c94ba4cb6e23e1f87e430b8f33">vortex_connection_get_channel_pool</a> over a connection will return the pool created. You can of course hold a reference to your channel pool and avoid using previous function.</p>
<p>The function <a class="el" href="group__vortex__channel__pool_ga3336a50e2f4437f64aa3334c4837ba02.html#ga3336a50e2f4437f64aa3334c4837ba02">vortex_channel_pool_get_next_ready</a> will return the next channel ready to be used. But this function may return NULL if no channel is ready to be used. You can optionally set the auto_inc parameter to increase channel pool size to resolve your petition.</p>
<p>Once the channel retreived from the channel pool is no longer required, it is "returned to the channel pool", to be usable by other queries, by calling to <a class="el" href="group__vortex__channel__pool_ga640cf86cb4cf7ddff6a03823208c1b14.html#ga640cf86cb4cf7ddff6a03823208c1b14">vortex_channel_pool_release_channel</a>.</p>
<p>See this section which contains more information about using the channel pool: <a class="el" href="starting__to__program.html#vortex_manual_implementing_request_response_pattern">3.2 Implementing the request-response pattern</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connection</em>&nbsp;</td><td>The session were channels will be created. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>profile</em>&nbsp;</td><td>The profile the channels will use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>init_num</em>&nbsp;</td><td>The number of channels this pool will create at the startup. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>close</em>&nbsp;</td><td>Handler to manage channel closing. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>close_user_data</em>&nbsp;</td><td>User data to be passed in to close handler. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>received</em>&nbsp;</td><td>Handler to manage frame reception on channel. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>received_user_data</em>&nbsp;</td><td>Data to be passed in to <em>received</em> handler. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>on_channel_pool_created</em>&nbsp;</td><td>A callback to be able to make channel process to be async. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>user_data</em>&nbsp;</td><td>User data to be passed in to <em>on_channel_created</em>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A newly created <a class="el" href="group__vortex__types_ga8335cf8b240d5f8a6ae9407a3c050bbf.html#ga8335cf8b240d5f8a6ae9407a3c050bbf">VortexChannelPool</a>. The reference returned is already attached to the <a class="el" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4">VortexConnection</a> provided so, it is not required to release it. In the case the <b>on_channel_pool_created</b> handler is provided, the function returns NULL, and the channel pool reference is notified at the handler. Memory deallocation for the reference returned will be produced once the connection associated to it is deallocated. </dd></dl>

</div>
</div>
    </td>
  </tr>
</table>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="lateral-ad">
  <iframe src="http://www.aspl.es/web-ads/index.php?hcolor=fdff4f&amp;fsize=10&amp;bg=555753&amp;fg=ffffff&amp;width=150&amp;type=vertical" height="420" align="middle" width="100%" scrolling="no" frameborder="0"></iframe>
</div>
<div class="footer">
<small>Vortex Library:  A BEEP (RFC3080/RFC3081) implementation. &nbsp; Copyright 2008 (C) Advanced Software Production Line, S.L.</small>
</div>
</body>
</html>

