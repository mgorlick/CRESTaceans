<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>Vortex Library, BEEP Core implementation, RFC 3080 / RFC 3081, XML-RPC, XML-RPC over BEEP, RFC 3529, BEEP Framework, BEEP protocol, BEEP, BEEP library, BEEP libraries, beepcore (Servidores Linux http://www.aspl.es)</title>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-123192-2";
urchinTracker();
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="vortex.css" rel="stylesheet" type="text/css">
</head>
  <body>
    <div class="af-arch-header">
     <img src="main-page-logo.png" > <a href="http://www.aspl.es"><img class="aspl-logo-header" src="aspl-logo-header.png"></a>
    </div>
    <div class="ads">
    <iframe src="http://www.aspl.es/web-ads/index.php?hcolor=fdff4f&amp;fsize=10&amp;bg=555753&amp;fg=ffffff&amp;width=800&amp;height=90" scrolling="no" frameborder="0"></iframe> 
    </div>
    <div class="separator">
    </div>
<div class="thepage">

<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="using_tunnel_profile">Vortex TUNNEL programming manual (C API) </a></h1><h2><a class="anchor" id="intro">
Introduction</a></h2>
<p>This manual shows you how to use the TUNNEL profile (RFC3620) implemented in Vortex Library, to allow performing BEEP connections through a BEEP proxy running also the TUNNEL profile.</p>
<p>The main idea behind BEEP is to allow you writing new network application protocols in an easy way reusing as much as possible mechanisms already tested in the past. In the same direction, the TUNNEL profile allows you to provide proxy support, with its all associated security advantages, to <b><em>any</em></b> protocol layered on top of BEEP.</p>
<p>The TUNNEL profile design is simple and elegant. You configure a TUNNEL to be created to the remote endpoint, and once establish the link, endpoint-to-endpoint, a new BEEP session is negotiated, allowing to create channels as it were no proxy in the middle.</p>
<h2><a class="anchor" id="tunnel_requirements">
TUNNEL profile requirements</a></h2>
<p>You must compile Vortex Library with TUNNEL support. Please refer to the installation manual: <a class="el" href="install.html">Installing and Using Vortex Library</a></p>
<h2><a class="anchor" id="setting_a_tunnel">
Creating a connection to the remote endpoint: setting a TUNNEL.</a></h2>
<p>The TUNNEL profile is only used to establish the endpoint-to-endpoint connection. Once created, channels are created and used as usual. In fact, creating connection (<a class="el" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4">VortexConnection</a>) with TUNNEL returns the same object.</p>
<p>Here is a simple example creating a connection, using a BEEP proxy:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__vortex__tunnel_gae81f1ee37562a47e9456f8eb98328f3b.html#gae81f1ee37562a47e9456f8eb98328f3b" title="Opaque type representing a proxy configuration used by the Vortex Engine to create...">VortexTunnelSettings</a> * settings;
 <a class="code" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4" title="A Vortex Connection object (BEEP session representation).">VortexConnection</a>     * connection;
 
 <span class="comment">// create a tunnel settings holder (being ctx a context already initialized</span>
 <span class="comment">// with vortex_ctx_new followed by vortex_init_ctx</span>
 settings = <a class="code" href="group__vortex__tunnel_gaf1bdac8037217641abff11ea329acfc0.html#gaf1bdac8037217641abff11ea329acfc0" title="Allows to create a new tunnel setting, a proxy configuration for any BEEP session...">vortex_tunnel_settings_new</a> (ctx);

 <span class="comment">// configure the tunnel</span>
 <a class="code" href="group__vortex__tunnel_ga534d5652774258dcaa584fba3bd011c9.html#ga534d5652774258dcaa584fba3bd011c9" title="Allows to configure a new hop to be added to the current proxy configuration.">vortex_tunnel_settings_add_hop</a> (settings,
                                 <a class="code" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64a21d369401b531c8b4cac49eb53c4d79d" title="IP version 4 address for the hop configuration.">TUNNEL_IP4</a>, <span class="stringliteral">&quot;80.43.98.134&quot;</span>
                                 <a class="code" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64a4f5fe4b7abd1f3652c6d164b22fcdac5" title="Tcp end point port for the hop configuration.">TUNNEL_PORT</a>, <span class="stringliteral">&quot;55000&quot;</span>,
                                 <a class="code" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64a287d2a56b1afb8228fc611989100802b" title="Beacon used by the vortex_tunnel_settings_add_hop function to signal that no more...">TUNNEL_END_CONF</a>);
 
 <a class="code" href="group__vortex__tunnel_ga534d5652774258dcaa584fba3bd011c9.html#ga534d5652774258dcaa584fba3bd011c9" title="Allows to configure a new hop to be added to the current proxy configuration.">vortex_tunnel_settings_add_hop</a> (settings,
                                 <a class="code" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64a21d369401b531c8b4cac49eb53c4d79d" title="IP version 4 address for the hop configuration.">TUNNEL_IP4</a>, <span class="stringliteral">&quot;192.168.0.133&quot;</span>,
                                 <a class="code" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64a4f5fe4b7abd1f3652c6d164b22fcdac5" title="Tcp end point port for the hop configuration.">TUNNEL_PORT</a>, <span class="stringliteral">&quot;604&quot;</span>,
                                 <a class="code" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64a287d2a56b1afb8228fc611989100802b" title="Beacon used by the vortex_tunnel_settings_add_hop function to signal that no more...">TUNNEL_END_CONF</a>);
 
 <span class="comment">// create the connection using tunnel settings</span>
 connection = <a class="code" href="group__vortex__tunnel_ga62a73b0b1fab64cfa93463f5ccaaac15.html#ga62a73b0b1fab64cfa93463f5ccaaac15" title="Creates a new BEEP session to the remote endpoint, using the information provided...">vortex_tunnel_new</a> (settings, NULL, NULL);
 <span class="keywordflow">if</span> (! <a class="code" href="group__vortex__connection_ga130045a0527441a1c20332cad32f0f4d.html#ga130045a0527441a1c20332cad32f0f4d" title="Allows to get current connection status.">vortex_connection_is_ok</a> (connection, axl_false)) {
       <span class="comment">// manage tunnel creation error </span>
 }
 
 <span class="comment">// tunnel created!</span>
</pre></div><p>Let's see what's happens here: </p>
<ol>
<li>
<p class="startli">First, a empty tunnel settings is created with: <a class="el" href="group__vortex__tunnel_gaf1bdac8037217641abff11ea329acfc0.html#gaf1bdac8037217641abff11ea329acfc0">vortex_tunnel_settings_new</a></p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Then, we configure the remote end point to connect to. Note this is not the actual BEEP proxy server in our network. In this case, we want to connect to the remote BEEP peer located at <b>80.43.98.134</b>, running at the tcp port: <b>55000</b>.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli">Finally, we configured the next hop to use, in this case, our local network BEEP proxy, which is located at the well known BEEP TUNNEL port: <b>192.168.0.133:604</b>.</p>
<p class="endli"></p>
</li>
</ol>
<p>Once the connection is created, you can use the usual API to create channels and to exchange data over those channels. A connection created by the <a class="el" href="group__vortex__tunnel.html">TUNNEL API</a> works with the same properties: you must close them using <a class="el" href="group__vortex__connection_gaa2cfa2eb776f65ce6805247f53cc1067.html#gaa2cfa2eb776f65ce6805247f53cc1067">vortex_connection_close</a> when no longer needed.</p>
<p>The example also shows that a settings configuration can be reused as many times as required. Once finished, it is also required to call: <a class="el" href="group__vortex__tunnel_ga88e8beccd9b974353bce726e0edc81b7.html#ga88e8beccd9b974353bce726e0edc81b7">vortex_tunnel_settings_free</a>.</p>
<h2><a class="anchor" id="tunnel_hop_inverse_order">
Configuring next hop in inverse order</a></h2>
<p>As you might note with previous example, the hop configuration first set the remote end point, and then the proxy to use. This is because every time you configure a next hop, this is added to the hop list to be traversed in the first position.</p>
<p>So, to create a tunnel with the following configuration:</p>
<div class="fragment"><pre class="fragment">    [BEEP PROXY 1] -&gt; [BEEP PROXY 2] -&gt; [ENDPOINT]
</pre></div><p>You must build the <a class="el" href="group__vortex__tunnel_gaf1bdac8037217641abff11ea329acfc0.html#gaf1bdac8037217641abff11ea329acfc0">tunnel setting</a> in the inverse order, that is, calling to <a class="el" href="group__vortex__tunnel_ga534d5652774258dcaa584fba3bd011c9.html#ga534d5652774258dcaa584fba3bd011c9">vortex_tunnel_settings_add_hop</a> with the address of <em>"ENDPOINT"</em>, followed by <em>"BEEP PROXY2"</em> and <em>"BEEP PROXY1"</em>.</p>
<h2><a class="anchor" id="vortex_tunnel_servers">
Are there any BEEP TUNNEL server already implemented?</a></h2>
<p>Sure, you can use <b>mod-tunnel</b> from <b>turbulence</b>. It currently provides full TUNNEL support, including <a class="el" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64a4b2745f0f39f45bceb583ccc0edb62a6">TUNNEL_ENDPOINT</a> and <a class="el" href="group__vortex__tunnel_ga73dca7ea99237eeba095ca9014791b64.html#gga73dca7ea99237eeba095ca9014791b64aa654ff515b894cd976182bfbb88e98e8">TUNNEL_URI</a> tunnel configurations. </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="lateral-ad">
  <iframe src="http://www.aspl.es/web-ads/index.php?hcolor=fdff4f&amp;fsize=10&amp;bg=555753&amp;fg=ffffff&amp;width=150&amp;type=vertical" height="420" align="middle" width="100%" scrolling="no" frameborder="0"></iframe>
</div>
<div class="footer">
<small>Vortex Library:  A BEEP (RFC3080/RFC3081) implementation. &nbsp; Copyright 2008 (C) Advanced Software Production Line, S.L.</small>
</div>
</body>
</html>

