<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>Vortex Library, BEEP Core implementation, RFC 3080 / RFC 3081, XML-RPC, XML-RPC over BEEP, RFC 3529, BEEP Framework, BEEP protocol, BEEP, BEEP library, BEEP libraries, beepcore (Servidores Linux http://www.aspl.es)</title>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-123192-2";
urchinTracker();
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="vortex.css" rel="stylesheet" type="text/css">
</head>
  <body>
    <div class="af-arch-header">
     <img src="main-page-logo.png" > <a href="http://www.aspl.es"><img class="aspl-logo-header" src="aspl-logo-header.png"></a>
    </div>
    <div class="ads">
    <iframe src="http://www.aspl.es/web-ads/index.php?hcolor=fdff4f&amp;fsize=10&amp;bg=555753&amp;fg=ffffff&amp;width=800&amp;height=90" scrolling="no" frameborder="0"></iframe> 
    </div>
    <div class="separator">
    </div>
<div class="thepage">

<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
  <div class="navpath"><a class="el" href="group__vortex__tls.html">Vortex TLS: TLS profile support and related functions</a>
  </div>
<table cellspacing="0" cellpadding="0" border="0">
  <tr>
   <td valign="top">
      <div class="navtab">
        <table>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga331c84ef581a5652b90d025f565fc633.html#ga331c84ef581a5652b90d025f565fc633">vortex_tls_accept_negotiation</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga3333fb271a38fe9fa6bde72a47deccfc.html#ga3333fb271a38fe9fa6bde72a47deccfc">vortex_tls_get_digest</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga7a93953a5d4f750040ebc24cc2aca8a0.html#ga7a93953a5d4f750040ebc24cc2aca8a0">vortex_tls_get_digest_sized</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga9b73730de9a02f7c372910bf16361bb3.html#ga9b73730de9a02f7c372910bf16361bb3">vortex_tls_get_peer_ssl_digest</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga14acd185722a0821d1153a511b54e7b5.html#ga14acd185722a0821d1153a511b54e7b5">vortex_tls_get_ssl_object</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga437e95cdf7763fb117b5668e0a5998bc.html#ga437e95cdf7763fb117b5668e0a5998bc">vortex_tls_init</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_gac686a001db0e2a27f488d404261ca921.html#gac686a001db0e2a27f488d404261ca921">VORTEX_TLS_PROFILE_URI</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga014ec55475b39014206886dd00ef9e86.html#ga014ec55475b39014206886dd00ef9e86">vortex_tls_set_auto_tls</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga60ee5a26cd2bcc0a1cda121e82bf1fc9.html#ga60ee5a26cd2bcc0a1cda121e82bf1fc9">vortex_tls_set_common_data</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga00461d1d4c09f208867c0f89ab359cc9.html#ga00461d1d4c09f208867c0f89ab359cc9">vortex_tls_set_ctx_creation</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga475b9d8efa81271d784091b21d165830.html#ga475b9d8efa81271d784091b21d165830">vortex_tls_set_default_ctx_creation</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga1a205361f9d943a8e38383c654ea0a97.html#ga1a205361f9d943a8e38383c654ea0a97">vortex_tls_set_default_post_check</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga2a385fd98f066f6856391084ffcfbba8.html#ga2a385fd98f066f6856391084ffcfbba8">vortex_tls_set_post_check</a></td></tr>
          <tr><td class="navtab"><a class="qindexHL" href="group__vortex__tls_gaa1e4243a5e9de386d8230edafcfad021.html#gaa1e4243a5e9de386d8230edafcfad021">vortex_tls_start_negotiation</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga788893a3196af18fe71dd1a91f334d58.html#ga788893a3196af18fe71dd1a91f334d58">vortex_tls_start_negotiation_sync</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_gae6204131aa6fe4aab9e0d571a382932d.html#gae6204131aa6fe4aab9e0d571a382932d">VortexDigestMethod</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga7aa743e27ab17360a2446678b8a92344.html#ga7aa743e27ab17360a2446678b8a92344">VortexTlsAcceptQuery</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga9d30465b906d99b8673c2059ace1b31d.html#ga9d30465b906d99b8673c2059ace1b31d">VortexTlsActivation</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga3ab0af63b6d2b2ecdf48443220baba24.html#ga3ab0af63b6d2b2ecdf48443220baba24">VortexTlsCertificateFileLocator</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga95cb6046ad10727a9df7cca75b6ef2dc.html#ga95cb6046ad10727a9df7cca75b6ef2dc">VortexTlsCtxCreation</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga6592b4f853286e59d02d180884d79283.html#ga6592b4f853286e59d02d180884d79283">VortexTlsPostCheck</a></td></tr>
          <tr><td class="navtab"><a class="qindex" href="group__vortex__tls_ga233882f24b0caaffd07da52f6595d38c.html#ga233882f24b0caaffd07da52f6595d38c">VortexTlsPrivateKeyFileLocator</a></td></tr>
        </table>
      </div>
   </td>
   <td valign="top">
<a class="anchor" id="gaa1e4243a5e9de386d8230edafcfad021"></a><!-- doxytag: member="vortex_tls.c::vortex_tls_start_negotiation" ref="gaa1e4243a5e9de386d8230edafcfad021" args="(VortexConnection *connection, const char *serverName, VortexTlsActivation process_status, axlPointer user_data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vortex_tls_start_negotiation </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4">VortexConnection</a> *&nbsp;</td>
          <td class="paramname"> <em>connection</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>serverName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__vortex__tls_ga9d30465b906d99b8673c2059ace1b31d.html#ga9d30465b906d99b8673c2059ace1b31d">VortexTlsActivation</a>&nbsp;</td>
          <td class="paramname"> <em>process_status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">axlPointer&nbsp;</td>
          <td class="paramname"> <em>user_data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts the TLS transport security negotiation on the given connection. </p>
<p>This function implements the client side for the TLS profile. Inside the BEEP protocol definition, the TLS profile provides a way to secure peer to peer data transmission, allowing to take advantage of it from any profile implemented on top of the BEEP stack. TLS profile allows to secure network connection using the TLS v1.0 protocol.</p>
<p>Here is an example on how to activate the TLS profile (details are explained after the example):</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// simple function with triggers the TLS process</span>
 <span class="keywordtype">void</span> activate_tls (<a class="code" href="group__vortex__types_ga879b03a2476b60c5b9b75489aabfe7db.html#ga879b03a2476b60c5b9b75489aabfe7db" title="Vortex library context.">VortexCtx</a> * ctx, <a class="code" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4" title="A Vortex Connection object (BEEP session representation).">VortexConnection</a> * connection) 
 {
     <span class="comment">// initialize and check if current vortex library supports TLS</span>
     <span class="keywordflow">if</span> (! <a class="code" href="group__vortex__tls_ga437e95cdf7763fb117b5668e0a5998bc.html#ga437e95cdf7763fb117b5668e0a5998bc" title="Initialize TLS library.">vortex_tls_init</a> (ctx)) {
         printf (<span class="stringliteral">&quot;Unable to activate TLS, Vortex is not prepared\n&quot;</span>);
         <span class="keywordflow">return</span>;
     }

     <span class="comment">// start the TLS profile negotiation process</span>
     <a class="code" href="group__vortex__tls_gaa1e4243a5e9de386d8230edafcfad021.html#gaa1e4243a5e9de386d8230edafcfad021" title="Starts the TLS transport security negotiation on the given connection.">vortex_tls_start_negotiation</a> (ctx, connection, NULL, 
                                   process_tls_status, NULL);
 }

 <span class="comment">// simple function with process the TLS status</span>
 <span class="keywordtype">void</span> process_tls_status (<a class="code" href="group__vortex__types_gac16883b703d1e546d54108153d4060b4.html#gac16883b703d1e546d54108153d4060b4" title="A Vortex Connection object (BEEP session representation).">VortexConnection</a> * connection,
                          <a class="code" href="group__vortex__types_ga25d85d2d28e8808a03b003e13c452e17.html#ga25d85d2d28e8808a03b003e13c452e17" title="Vortex Operation Status.">VortexStatus</a>       status,
                          <span class="keywordtype">char</span>             * status_message,
                          axlPointer         user_data)
 {
      <span class="keywordflow">switch</span> (status) {
      <span class="keywordflow">case</span> <a class="code" href="group__vortex__types_ga25d85d2d28e8808a03b003e13c452e17.html#gga25d85d2d28e8808a03b003e13c452e17aa6d3a6595c96e728ca3cd55164407fb6" title="Represents the operation have been successfully completed.">VortexOk</a>:
           printf (<span class="stringliteral">&quot;TLS negotiation OK! over the new connection %d\n&quot;</span>,
                    <a class="code" href="group__vortex__connection_ga18a016fd0efe5f5ef7d21d5dc5e1e1f7.html#ga18a016fd0efe5f5ef7d21d5dc5e1e1f7" title="Returns the connection unique identifier.">vortex_connection_get_id</a> (connection));

           <span class="comment">// use the new connection reference provided by </span>
           <span class="comment">// this function. Connection provided at </span>
           <span class="comment">// vortex_tls_start_negotiation have been unrefered.</span>
           <span class="comment">// In this case, my_server_connection have been </span>
           <span class="comment">// already unrefered by the TLS activation</span>
           my_server_connection = connection;           

           <span class="keywordflow">break</span>;
      <span class="keywordflow">case</span> <a class="code" href="group__vortex__types_ga25d85d2d28e8808a03b003e13c452e17.html#gga25d85d2d28e8808a03b003e13c452e17af832d5ec80b9b87f8e7d6ef0a5fd3366" title="Represents an Error while Vortex Library was operating.">VortexError</a>: 
           printf (<span class="stringliteral">&quot;TLS negotiation have failed, message: %s\n&quot;</span>,
                    status_message);
           <span class="comment">// ok, TLS process have failed but, do we have a connection</span>
           <span class="comment">// still working?. This is checked using</span>
           <span class="keywordflow">if</span> (<a class="code" href="group__vortex__connection_ga130045a0527441a1c20332cad32f0f4d.html#ga130045a0527441a1c20332cad32f0f4d" title="Allows to get current connection status.">vortex_connection_is_ok</a> (connection, axl_false)) {
              <span class="comment">// well we don&#39;t have TLS activated but the connection</span>
              <span class="comment">// still works</span>
              my_server_connection = connection;
           } 
           <span class="keywordflow">break</span>;
      }
      <span class="keywordflow">return</span>;
 }
</pre></div><p>As the previous example shows, the function requires the connection where the TLS process will take place, a handler to <a class="el" href="group__vortex__tls_ga9d30465b906d99b8673c2059ace1b31d.html#ga9d30465b906d99b8673c2059ace1b31d">notify the TLS status</a>, an optional serverName string to notify listener side to act as a particular server name and an optional user data.</p>
<p>While the TLS negotiation is running, user application could still perform other tasks because this function doesn't block the caller. Once the TLS process have finished, no matter its result, the status will be notified using <a class="el" href="group__vortex__tls_ga9d30465b906d99b8673c2059ace1b31d.html#ga9d30465b906d99b8673c2059ace1b31d">process_status</a> handler.</p>
<p>Because the TLS negotiation involves a tuning reset, the connection provided to this function will be unrefered without closing the associated socket. This means that the connection provided to this function must be no longer used, closed or unrefered. No transfer operation must take place during the TLS activation.</p>
<p>The connection provided at <a class="el" href="group__vortex__tls_ga9d30465b906d99b8673c2059ace1b31d.html#ga9d30465b906d99b8673c2059ace1b31d">process_status</a> handler is the one to be used once the TLS process have finished properly.</p>
<p>Because the TLS negotiation could fail user code placed at the process function should check if the new connection provided on that function is still working. This is because many things could fail while TLS negotiation takes place. Some of them represents protocol violation involving the connection to be closed, the others just means the TLS have failed but the connection is still valid not only to try again the TLS activation but to use it without secure transmission.</p>
<p>Once TLS is activated on a connection the function just return without doing nothing, if an attempt to secure the connection is made again. You could check TLS status for a given connection using <a class="el" href="group__vortex__connection_ga418ee4df18dd89a6363c67fa8e24ba6c.html#ga418ee4df18dd89a6363c67fa8e24ba6c">vortex_connection_is_tlsficated</a>.</p>
<p>A call to <a class="el" href="group__vortex__tls_ga437e95cdf7763fb117b5668e0a5998bc.html#ga437e95cdf7763fb117b5668e0a5998bc">vortex_tls_init</a> is required to start the TLS context inside the provided <a class="el" href="group__vortex__types_ga879b03a2476b60c5b9b75489aabfe7db.html#ga879b03a2476b60c5b9b75489aabfe7db">VortexCtx</a>. Next calls won't perform any operation more than returning axl_true (signaling the library is/was initialized).</p>
<p>If you need to know more about how to activate TLS support on server side (well, actually for the listener role) check out this function: <a class="el" href="group__vortex__tls_ga331c84ef581a5652b90d025f565fc633.html#ga331c84ef581a5652b90d025f565fc633">vortex_tls_accept_negotiation</a>.</p>
<p>Additionally, you can also consider to make Vortex Library to automatically handle TLS profile negotiation for every connection created. This is done by using <a class="el" href="group__vortex__tls_ga014ec55475b39014206886dd00ef9e86.html#ga014ec55475b39014206886dd00ef9e86">vortex_tls_set_auto_tls</a> function. Once activated, every call to <a class="el" href="group__vortex__connection_ga727b938695d1037058256e3559d9d599.html#ga727b938695d1037058256e3559d9d599">vortex_connection_new</a> will automatically negotiate the TLS profile once connected before notifying user space code for the connection creation.</p>
<p><b>NOTE:</b> As part of the TLS negotiation, all channels inside the given connection will be closed.</p>
<p><b>NOTE:</b> The connection provided will be unrefered and a new connection will be provided by this function, but using the same associated transport descriptor (socket). This means the connection passed to this function and the connection created by this function will both link to the same peer but being different instances.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>connection</em>&nbsp;</td><td>The connection where the secure transport will be started.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>serverName</em>&nbsp;</td><td>A server name value to be notified to the remote peer so it could react in a different way depending on this value. Function will perform a copy from the given value. You can free the passed in value just after the function returns.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>process_status</em>&nbsp;</td><td>A handler to be executed once the process have finished, no matter its result. This handler is required. Note that not provided this handler the function will return without doing nothing silently.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>user_data</em>&nbsp;</td><td>A user defined data to be passed in to the <em>process_status</em> handler. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
    </td>
  </tr>
</table>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div>
<div class="lateral-ad">
  <iframe src="http://www.aspl.es/web-ads/index.php?hcolor=fdff4f&amp;fsize=10&amp;bg=555753&amp;fg=ffffff&amp;width=150&amp;type=vertical" height="420" align="middle" width="100%" scrolling="no" frameborder="0"></iframe>
</div>
<div class="footer">
<small>Vortex Library:  A BEEP (RFC3080/RFC3081) implementation. &nbsp; Copyright 2008 (C) Advanced Software Production Line, S.L.</small>
</div>
</body>
</html>

